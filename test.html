<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒµé‡‘ç¿»è­¯ v3.0 å°ˆæ¥­æ¸¬è©¦ç‰ˆ</title>
    <style>
        :root { --primary: #007d32; --bg: #f8f9fa; --accent: #1877F2; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); padding: 15px; display: flex; justify-content: center; }
        .container { background: white; width: 100%; max-width: 500px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .status-bar { font-size: 12px; color: #666; text-align: center; margin-bottom: 15px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; background: #ccc; margin-right: 5px; }
        .dot-online { background: #28a745; box-shadow: 0 0 5px #28a745; }

        select, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #eee; border-radius: 10px; box-sizing: border-box; font-size: 16px; }
        
        .mic-box { position: relative; margin-bottom: 15px; }
        .btn-mic { background: #dc3545; color: white; border: none; padding: 18px; width: 100%; border-radius: 12px; cursor: pointer; font-size: 18px; font-weight: bold; transition: 0.3s; }
        .btn-mic.recording { background: #ffc107; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        .btn-main { background: var(--primary); color: white; border: none; padding: 15px; width: 100%; border-radius: 12px; cursor: pointer; font-size: 18px; font-weight: bold; box-shadow: 0 4px 0 var(--secondary-color); }

        #resultArea { background: #fff; border-left: 6px solid var(--primary); padding: 15px; margin-top: 20px; border-radius: 8px; font-size: 20px; min-height: 80px; box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); }
        
        .action-links { display: flex; justify-content: space-between; margin-top: 15px; font-size: 14px; }
        .action-links a { color: var(--accent); text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="status-bar"><span id="statusDot" class="dot"></span> <span id="statusTxt">ç³»çµ±åˆå§‹åŒ–ä¸­...</span></div>
    
    <label>è«‹é¸æ“‡èªªè©±è€…çš„èªè¨€ï¼š</label>
    <select id="langSelect">
        <option value="zh-TW">ä¸­æ–‡ (ç¹é«”)</option>
        <option value="en-US">è‹±æ–‡ (English)</option>
        <option value="ja-JP">æ—¥æ–‡ (æ—¥æœ¬èª)</option>
        <option value="vi-VN">è¶Šå—æ–‡ (Tiáº¿ng Viá»‡t)</option>
        <option value="id-ID">å°å°¼æ–‡ (Bahasa Indonesia)</option>
        <option value="th-TH">æ³°æ–‡ (à¹„à¸—à¸¢)</option>
    </select>

    <div class="mic-box">
        <button id="micBtn" class="btn-mic" onclick="toggleMic()">ğŸ¤ é»æ“Šé–‹å§‹éŒ„éŸ³</button>
    </div>

    <textarea id="inputText" placeholder="èªéŸ³è¾¨è­˜å…§å®¹..."></textarea>
    
    <button id="transBtn" class="btn-main" onclick="doTranslate()">ç¿»è­¯æˆä¸­æ–‡ (å°ˆæ¥­è©åº«)</button>

    <div id="resultArea">ç¿»è­¯çµæœæœƒåœ¨æ­¤é¡¯ç¤º...</div>
    <button onclick="speakResult()" style="margin-top:10px; background:none; border:1px solid #ccc; border-radius:5px; cursor:pointer; font-size:12px; padding:5px;">ğŸ”Š æœ—è®€çµæœ</button>

    <div class="action-links">
        <a href="#" onclick="alert('å»ºè­°å·²è¨˜éŒ„è‡³è©¦ç®—è¡¨')">æäº¤ä¿®æ­£</a>
        <a href="https://www.facebook.com/share/17bAA8kb9q/" target="_blank">è¯ç¹«ç®¡ç†å“¡</a>
    </div>
</div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyN_OLZr_Nk0GhJU56E890fGKjtCashTJlVbS8PMGgFijFZd4mdHdwlOVXT0rkqtK7E/exec";
    
    // åˆå§‹åŒ–èªéŸ³è¾¨è­˜
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    let isRecording = false;

    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.onresult = (e) => {
            document.getElementById('inputText').value = e.results[0][0].transcript;
            stopMicStyle();
            doTranslate(); // è¾¨è­˜å®Œè‡ªå‹•ç¿»è­¯
        };

        recognition.onerror = () => stopMicStyle();
        recognition.onend = () => stopMicStyle();
    }

    function toggleMic() {
        if (!recognition) return alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜");
        if (isRecording) {
            recognition.stop();
        } else {
            recognition.lang = document.getElementById('langSelect').value;
            recognition.start();
            isRecording = true;
            document.getElementById('micBtn').innerText = "ğŸ›‘ æ­£åœ¨è†è½...";
            document.getElementById('micBtn').classList.add('recording');
        }
    }

    function stopMicStyle() {
        isRecording = false;
        document.getElementById('micBtn').innerText = "ğŸ¤ é»æ“Šé–‹å§‹éŒ„éŸ³";
        document.getElementById('micBtn').classList.remove('recording');
    }

    async function doTranslate() {
        const text = document.getElementById('inputText').value;
        const resDiv = document.getElementById('resultArea');
        if (!text) return;

        resDiv.innerText = "æ­£åœ¨é€²è¡Œå¤šåœ‹èªè©åº«æ¯”å°...";
        
        try {
            const response = await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({ action: "translate", text: text, target: "zh-TW" })
            });
            const data = await response.json();
            resDiv.innerText = data.result;
        } catch (e) {
            resDiv.innerText = "ç¿»è­¯ç™¼ç”ŸéŒ¯èª¤ã€‚";
        }
    }

    function speakResult() {
        const text = document.getElementById('resultArea').innerText;
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'zh-TW';
        window.speechSynthesis.speak(msg);
    }

    // æª¢æŸ¥é€£ç·š
    window.onload = async () => {
        try {
            await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "translate", text: "ping" }) });
            document.getElementById('statusDot').classList.add('dot-online');
            document.getElementById('statusTxt').innerText = "ç³»çµ±é€£ç·šæ­£å¸¸";
        } catch (e) {
            document.getElementById('statusTxt').innerText = "é€£ç·šç•°å¸¸";
        }
    };
</script>

</body>
</html>
