<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒµé‡‘ç¿»è­¯ v3.1 å°ˆæ¥­ç‰ˆ</title>
    <style>
        :root { --primary: #007d32; --secondary: #005a24; --fb: #1877F2; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f0f4f2; margin: 0; padding: 15px; display: flex; justify-content: center; }
        .container { background: white; width: 100%; max-width: 500px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        /* ä»‹é¢åˆ‡æ›æ¨£å¼ */
        .ui-lang-selector { text-align: right; margin-bottom: 10px; }
        .ui-lang-selector button { font-size: 11px; padding: 3px 8px; cursor: pointer; border: 1px solid #ddd; background: #fff; border-radius: 4px; }
        .ui-active { background: var(--primary) !important; color: white; border-color: var(--primary); }

        .status-bar { font-size: 11px; color: #888; text-align: center; margin-bottom: 15px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; background: #ccc; margin-right: 5px; }
        .dot-online { background: #28a745; box-shadow: 0 0 5px #28a745; }

        label { font-weight: bold; font-size: 13px; color: #444; }
        select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #eee; border-radius: 10px; box-sizing: border-box; font-size: 16px; transition: 0.3s; }
        textarea:focus { border-color: var(--primary); outline: none; }
        
        .mic-box { margin-bottom: 15px; }
        .btn-mic { background: #dc3545; color: white; border: none; padding: 16px; width: 100%; border-radius: 12px; cursor: pointer; font-size: 18px; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .recording { background: #ffc107; animation: pulse 1s infinite; }
        @keyframes pulse { 50% { opacity: 0.7; } }

        .btn-main { background: var(--primary); color: white; border: none; padding: 16px; width: 100%; border-radius: 12px; cursor: pointer; font-size: 18px; font-weight: bold; }
        
        #resultArea { background: #f9f9f9; border-left: 6px solid var(--primary); padding: 15px; margin-top: 15px; border-radius: 8px; font-size: 18px; min-height: 60px; word-wrap: break-word; }
        
        .feedback-section { margin-top: 25px; padding: 15px; background: #fdfdfd; border: 1px solid #eee; border-radius: 12px; }
        .contact-footer { margin-top: 25px; text-align: center; border-top: 1px solid #eee; padding-top: 15px; }
        .fb-badge { display: inline-flex; align-items: center; gap: 6px; background: #e7f3ff; color: var(--fb); padding: 5px 15px; border-radius: 20px; text-decoration: none; font-weight: bold; font-size: 13px; }
    </style>
</head>
<body>

<div class="container">
    <div class="ui-lang-selector">
        <button onclick="switchUI('zh')" id="ui-zh" class="ui-active">ä¸­</button>
        <button onclick="switchUI('en')" id="ui-en">EN</button>
    </div>

    <h2 id="ui-title" style="text-align: center; color: var(--primary); margin: 0 0 5px 0;">éƒµé‡‘ç¿»è­¯å°ˆæ¥­ç‰ˆ</h2>
    <div class="status-bar"><span id="statusDot" class="dot"></span> <span id="statusTxt">è©åº«æª¢æŸ¥ä¸­...</span></div>
    
    <label id="ui-label-src">1. é¸æ“‡èªªè©±èªè¨€ï¼š</label>
    <select id="srcLang">
        <option value="zh-TW">ä¸­æ–‡ (ç¹é«”)</option>
        <option value="en-US">è‹±æ–‡ (English)</option>
        <option value="ja-JP">æ—¥æ–‡ (æ—¥æœ¬èª)</option>
        <option value="vi-VN">è¶Šå—æ–‡ (Tiáº¿ng Viá»‡t)</option>
        <option value="id-ID">å°å°¼æ–‡ (Bahasa Indonesia)</option>
    </select>

    <label id="ui-label-tar">2. é¸æ“‡ç¿»è­¯ç›®æ¨™ï¼š</label>
    <select id="tarLang">
        <option value="zh-TW">ç¿»è­¯æˆ ä¸­æ–‡</option>
        <option value="en-US">Translate to English</option>
        <option value="ja-JP">æ—¥æœ¬èªã«ç¿»è¨³</option>
        <option value="vi-VN">Dá»‹ch sang tiáº¿ng Viá»‡t</option>
        <option value="id-ID">Terjemahkan ke Indonesia</option>
    </select>

    <div class="mic-box">
        <button id="micBtn" class="btn-mic" onclick="toggleMic()">ğŸ¤ <span id="ui-mic">é»æ“ŠéŒ„éŸ³ (å¯ä¿®æ­£æ–‡å­—)</span></button>
    </div>

    <textarea id="inputText" placeholder="è¾¨è­˜çµæœæœƒå‡ºç¾åœ¨é€™ï¼Œæ‚¨å¯ä»¥æ‰‹å‹•ä¿®æ”¹..."></textarea>
    
    <button id="transBtn" class="btn-main" onclick="doTranslate()" id="ui-btn-trans">é–‹å§‹å°ˆæ¥­ç¿»è­¯</button>

    <div id="resultArea">...</div>

    <div class="feedback-section">
        <label id="ui-label-fix">ğŸ’¡ æä¾›ä¿®æ­£å»ºè­°ï¼š</label>
        <input type="text" id="suggestText" style="width:100%; padding:8px; margin:5px 0; border-radius:5px; border:1px solid #ddd;" placeholder="æ­£ç¢ºè­¯æ–‡...">
        <button onclick="submitFeedback()" style="font-size:12px; cursor:pointer;" id="ui-btn-fix">æäº¤å»ºè­°</button>
    </div>

    <div class="contact-footer">
        <p style="font-size: 11px; color: #999; margin-bottom: 8px;">ç³»çµ±ç¶­è­·èˆ‡å°ˆæ¥­æ”¯æ´</p>
        <a href="https://www.facebook.com/share/17bAA8kb9q/" target="_blank" class="fb-badge">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V15.97c3.824-.603 6.75-3.933 6.75-7.922z"/></svg>
            è¯ç¹«å°å„ªåŒ–å°ˆæ¥­å®¤
        </a>
    </div>
</div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxAufILMrF9JqslmPK2WEQB31A7DUKA4LwPzSwKYw7oxzphQHS8-YOo2GgY6LtonMEE/exec";
    
    // å¤šåœ‹ä»‹é¢å®šç¾©
    const i18n = {
        zh: { title: "éƒµé‡‘ç¿»è­¯å°ˆæ¥­ç‰ˆ", src: "1. é¸æ“‡èªªè©±èªè¨€ï¼š", tar: "2. é¸æ“‡ç¿»è­¯ç›®æ¨™ï¼š", mic: "é»æ“ŠéŒ„éŸ³ (å¯ä¿®æ­£æ–‡å­—)", btn: "é–‹å§‹å°ˆæ¥­ç¿»è­¯", fix: "æä¾›ä¿®æ­£å»ºè­°ï¼š", fb: "è¯ç¹«å°å„ªåŒ–å°ˆæ¥­å®¤" },
        en: { title: "Post & Bank Translator", src: "1. Source Language:", tar: "2. Target Language:", mic: "Tap to Record (Editable)", btn: "Start Translation", fix: "Suggest Correction:", fb: "Contact Optimization Studio" }
    };

    function switchUI(lang) {
        document.getElementById('ui-title').innerText = i18n[lang].title;
        document.getElementById('ui-label-src').innerText = i18n[lang].src;
        document.getElementById('ui-label-tar').innerText = i18n[lang].tar;
        document.getElementById('ui-mic').innerText = i18n[lang].mic;
        document.getElementById('transBtn').innerText = i18n[lang].btn;
        document.getElementById('ui-label-fix').innerText = i18n[lang].fix;
        document.getElementById('ui-zh').classList.toggle('ui-active', lang==='zh');
        document.getElementById('ui-en').classList.toggle('ui-active', lang==='en');
    }

    // èªéŸ³è¾¨è­˜
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.onresult = (e) => {
            document.getElementById('inputText').value = e.results[0][0].transcript;
            stopMicStyle();
        };
        recognition.onend = () => stopMicStyle();
    }

    function toggleMic() {
        if (!recognition) return alert("ä¸æ”¯æ´æ­¤ç€è¦½å™¨èªéŸ³åŠŸèƒ½");
        recognition.lang = document.getElementById('srcLang').value;
        recognition.start();
        document.getElementById('micBtn').classList.add('recording');
    }

    function stopMicStyle() { document.getElementById('micBtn').classList.remove('recording'); }

    async function doTranslate() {
        const text = document.getElementById('inputText').value;
        const target = document.getElementById('tarLang').value;
        if (!text) return;
        document.getElementById('resultArea').innerText = "è™•ç†ä¸­...";
        try {
            const res = await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({ action: "translate", text: text, target: target })
            });
            const data = await res.json();
            document.getElementById('resultArea').innerText = data.result;
        } catch (e) { document.getElementById('resultArea').innerText = "é€£ç·šå¤±æ•—"; }
    }

    async function submitFeedback() {
        const source = document.getElementById('inputText').value;
        const suggestion = document.getElementById('suggestText').value;
        if (!source || !suggestion) return alert("è«‹å¡«å¯«åŸå¥èˆ‡å»ºè­°");
        try {
            const res = await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({ action: "feedback", source: source, suggestion: suggestion })
            });
            const data = await res.json();
            if(data.result === "Success") {
                alert("æäº¤æˆåŠŸï¼å¾Œå°å·²è¨˜éŒ„ã€‚");
                document.getElementById('suggestText').value = "";
            }
        } catch (e) { alert("æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚"); }
    }

    window.onload = async () => {
        try {
            await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "translate", text: "ping" }) });
            document.getElementById('statusDot').classList.add('dot-online');
            document.getElementById('statusTxt').innerText = "è©åº«é€£ç·šæ­£å¸¸";
        } catch (e) {}
    };
</script>
</body>
</html>
