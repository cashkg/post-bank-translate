<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒµé‡‘ç¿»è­¯ v3.0 æ¸¬è©¦ç‰ˆ</title>
    <style>
        :root { --primary-color: #007d32; --bg-color: #f8f9fa; }
        body { font-family: sans-serif; background: var(--bg-color); padding: 15px; display: flex; justify-content: center; }
        .container { background: white; width: 100%; max-width: 500px; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .lang-select { width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ddd; font-weight: bold; }
        textarea { width: 100%; height: 100px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .voice-btn { background: #e9ecef; border: none; padding: 8px; border-radius: 5px; cursor: pointer; margin-top: 5px; font-size: 13px; }
        .btn-translate { width: 100%; padding: 14px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-weight: bold; margin-top: 15px; cursor: pointer; }
        #resultArea { background: #fff; border: 1px solid #eee; border-left: 5px solid var(--primary-color); padding: 15px; margin-top: 15px; border-radius: 5px; position: relative; }
        .speak-icon { cursor: pointer; float: right; font-size: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="color:var(--primary-color); text-align:center;">éƒµé‡‘åŠ©æ‰‹ v3.0 TEST</h2>
    
    <label>1. é¸æ“‡ç›®æ¨™èªè¨€ï¼š</label>
    <select id="langPicker" class="lang-select">
        <option value="en">è‹±æ–‡ (English)</option>
        <option value="id">å°å°¼æ–‡ (Bahasa Indonesia)</option>
        <option value="vi">è¶Šå—æ–‡ (Tiáº¿ng Viá»‡t)</option>
    </select>

    <label>2. è¼¸å…¥ä¸­æ–‡ (æ”¯æ´èªéŸ³è¼¸å…¥)ï¼š</label>
    <textarea id="inputText" placeholder="è«‹è¼¸å…¥æˆ–é»æ“Šä¸‹æ–¹èªéŸ³æŒ‰éˆ•..."></textarea>
    <button class="voice-btn" onclick="startDictation()">ğŸ¤ èªéŸ³è¼¸å…¥</button>

    <button class="btn-translate" onclick="doTranslate()">åŸ·è¡Œå°ˆæ¥­ç¿»è­¯</button>

    <div id="resultArea">
        <span id="speakBtn" class="speak-icon" onclick="speakResult()" style="display:none;">ğŸ”Š</span>
        <div id="translatedText">ç¿»è­¯çµæœå°‡é¡¯ç¤ºæ–¼æ­¤...</div>
    </div>
</div>

<script>
    const GAS_URL = "æ‚¨çš„_GAS_URL";

    // èªéŸ³è¼¸å…¥ (Speech to Text)
    function startDictation() {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'zh-TW';
        recognition.start();
        recognition.onresult = (event) => {
            document.getElementById('inputText').value = event.results[0][0].transcript;
        };
    }

    // åŸ·è¡Œç¿»è­¯
    async function doTranslate() {
        const text = document.getElementById('inputText').value;
        const lang = document.getElementById('langPicker').value;
        const resultDiv = document.getElementById('translatedText');
        
        if (!text) return;
        resultDiv.innerText = "æ­£åœ¨é€²è¡Œå¤šåœ‹èªèª¿é…...";

        try {
            const response = await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({ action: "translate", text: text, targetLang: lang })
            });
            const data = await response.json();
            resultDiv.innerText = data.result;
            document.getElementById('speakBtn').style.display = "block";
        } catch (e) {
            resultDiv.innerText = "é€£ç·šå¤±æ•—";
        }
    }

    // èªéŸ³æœ—è®€ (Text to Speech)
    function speakResult() {
        const text = document.getElementById('translatedText').innerText;
        const lang = document.getElementById('langPicker').value;
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = lang; // è‡ªå‹•æ ¹æ“šé¸æ“‡çš„èªè¨€ç™¼éŸ³
        window.speechSynthesis.speak(msg);
    }
</script>

</body>
</html>
